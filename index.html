<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snooker Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .status-dot {
            height: 10px;
            width: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-available { background-color: #10B981; } /* Green */
        .status-in-use { background-color: #EF4444; }   /* Red */
        .status-pending { background-color: #F59E0B; } /* Amber */
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-6">
        <!-- Header -->
        <header class="flex justify-between items-center mb-4 flex-wrap gap-2">
            <h1 class="text-3xl font-bold text-gray-900">Snooker Management System</h1>
            <div class="flex items-center space-x-2">
                 <button onclick="openModal('add-credit-modal')" class="relative flex items-center space-x-2 px-4 py-2 text-sm bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" /></svg>
                    <span>Credit</span>
                    <span id="credit-notification-dot" class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full hidden"></span>
                 </button>
                 <button onclick="openWaitingListModal()" class="relative flex items-center space-x-2 px-4 py-2 text-sm bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>Waiting</span>
                    <span id="waiting-list-count" class="absolute -top-2 -right-2 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-500 rounded-full hidden"></span>
                 </button>
                 <button onclick="openTransactionsModal()" class="relative flex items-center space-x-2 px-4 py-2 text-sm bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    <span>Transactions</span>
                    <span id="transactions-count" class="absolute -top-2 -right-2 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-blue-500 rounded-full hidden"></span>
                 </button>
                 <button onclick="openModal('canteen-modal')" class="flex items-center space-x-2 px-4 py-2 text-sm bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-pink-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21 15.546c-.523 0-1.046.151-1.5.454a2.704 2.704 0 01-3 0 2.704 2.704 0 00-3 0 2.704 2.704 0 01-3 0 2.704 2.704 0 00-3 0c-.454-.303-.977-.454-1.5-.454V5.73c0-1.268.502-2.427 1.318-3.242A4.5 4.5 0 017.5 1.5h9a4.5 4.5 0 013.182 1.012A4.486 4.486 0 0121 5.73v9.816z" />
                    </svg>
                    <span>Canteen</span>
                 </button>
                 <button onclick="openPaidRecordsModal()" class="relative flex items-center space-x-2 px-4 py-2 text-sm bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span>Paid</span>
                    <span id="paid-records-count" class="absolute -top-2 -right-2 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-green-600 rounded-full hidden"></span>
                 </button>
                 <button onclick="openModal('admin-login-modal')" class="flex items-center space-x-2 px-4 py-2 text-sm bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    <span>Admin</span>
                 </button>
            </div>
        </header>
        
        <div class="flex items-center space-x-4 mb-6 text-sm text-gray-600">
            <div class="flex items-center"><span class="status-dot status-available"></span>Free</div>
            <div class="flex items-center"><span class="status-dot status-in-use"></span>Playing</div>
            <div class="flex items-center"><span class="status-dot status-pending"></span>Pending</div>
        </div>

        <div class="bg-white rounded-lg shadow overflow-hidden">
            <table class="min-w-full"><thead class="bg-green-600 text-white"><tr><th class="py-3 px-4 text-left text-sm font-semibold uppercase">Table #</th><th class="py-3 px-4 text-left text-sm font-semibold uppercase">Players</th><th class="py-3 px-4 text-left text-sm font-semibold uppercase">Game Type</th><th class="py-3 px-4 text-left text-sm font-semibold uppercase">Start Time</th><th class="py-3 px-4 text-left text-sm font-semibold uppercase">Duration</th><th class="py-3 px-4 text-left text-sm font-semibold uppercase">Price</th><th class="py-3 px-4 text-left text-sm font-semibold uppercase">Status</th><th class="py-3 px-4 text-left text-sm font-semibold uppercase">Actions</th></tr></thead><tbody id="tables-body" class="divide-y divide-gray-200"></tbody></table>
        </div>
        
        <footer class="text-center text-sm text-gray-500 mt-6">© Snooker Manager • Demo UI • Theme: Light</footer>
    </div>

    <!-- Modals -->
    <div id="start-game-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-1/3"><h2 class="text-2xl font-bold mb-4 text-gray-900" id="modal-title">Start Game</h2><form id="start-game-form"><input type="hidden" id="modal-table-id"><div class="mb-4"><label for="player1" class="block text-sm font-medium text-gray-700 mb-1">Player 1 Name:</label><input type="text" id="player1" class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900" oninput="capitalizeInput(this)" required></div><div class="mb-4"><label for="player2" class="block text-sm font-medium text-gray-700 mb-1">Player 2 Name:</label><input type="text" id="player2" class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900" oninput="capitalizeInput(this)" required></div><div class="mb-6"><label for="game-type" class="block text-sm font-medium text-gray-700 mb-1">Game Type:</label><select id="game-type" class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900"></select></div><div class="flex justify-end space-x-4"><button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-800 hover:bg-gray-300 rounded-md font-semibold">Cancel</button><button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md font-semibold">Start Game</button></div></form></div></div>
    <div id="confirmation-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-1/4 text-center"><h2 id="confirm-title" class="text-xl font-bold mb-4 text-gray-900">Confirmation</h2><p id="confirm-message" class="text-gray-600 mb-6">Are you sure?</p><div class="flex justify-center space-x-4"><button id="confirm-cancel" class="px-6 py-2 bg-gray-200 text-gray-800 hover:bg-gray-300 rounded-md font-semibold">Cancel</button><button id="confirm-ok" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md font-semibold">OK</button></div></div></div>
    <div id="add-credit-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-1/3"><div class="flex justify-between items-start"><h2 class="text-2xl font-bold mb-4 text-gray-900">Add Credit / Debit</h2><button onclick="viewLedgerFromCredit()" class="relative flex items-center space-x-2 text-sm text-blue-600 hover:text-blue-800 font-semibold"><span>History</span><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg><span id="history-notification-dot" class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full hidden"></span></button></div><form id="add-credit-form"><input type="hidden" id="credit-table-id"><input type="hidden" id="credit-waiting-id"><div class="mb-4"><label for="credit-name" class="block text-sm font-medium text-gray-700 mb-1">Customer's Name</label><input type="text" id="credit-name" class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900" oninput="capitalizeInput(this)" required></div><div class="mb-4"><label for="credit-amount" class="block text-sm font-medium text-gray-700 mb-1">Amount</label><input type="number" id="credit-amount" class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900" placeholder="Debit amount (e.g. 500)" required></div><div class="mb-6"><label for="credit-note" class="block text-sm font-medium text-gray-700 mb-1">Note (Optional)</label><textarea id="credit-note" rows="2" class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900"></textarea></div><div class="flex justify-end space-x-4"><button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-800 hover:bg-gray-300 rounded-md font-semibold">Cancel</button><button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md font-semibold">Save Entry</button></div></form></div></div>
    <div id="ledger-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-2/3 lg:w-1/2"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-gray-900">Credits</h2><button onclick="closeModal()" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button></div><div class="mb-4"><input type="search" id="ledger-search" onkeyup="filterTable('ledger-search', 'ledger-body', 0)" placeholder="Search by name..." class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900"></div><div class="max-h-96 overflow-y-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Last Updated</th><th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Balance</th><th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Action</th></tr></thead><tbody id="ledger-body" class="bg-white divide-y divide-gray-200"></tbody></table></div><div id="ledger-summary" class="mt-4 pt-4 border-t-2 border-gray-200 text-right"></div></div></div>
    <div id="pay-credit-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-1/3"><h2 id="pay-credit-title" class="text-2xl font-bold mb-4 text-gray-900">Pay Credit</h2><p id="pay-credit-balance" class="mb-4"></p><div class="mb-4"><label for="pay-credit-amount" class="block text-sm font-medium text-gray-700 mb-1">Amount to Pay</label><input type="number" id="pay-credit-amount" class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900"><p id="pay-credit-warning" class="text-red-500 text-xs mt-1">Payment should be equal to or less than credit.</p></div><div class="flex justify-between items-center space-x-4"><button id="pay-credit-clear-all" class="w-full px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded-md font-semibold">Clear All Credit</button><button id="pay-credit-submit" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md font-semibold">Pay</button></div> <button onclick="closeModal()" class="mt-6 text-sm text-gray-500 hover:text-gray-700">Cancel</button></div></div>
    <div id="who-won-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-1/3 text-center"><h2 class="text-2xl font-bold mb-4 text-gray-900">Who Won?</h2><div class="space-y-4"><button id="who-won-p1" class="w-full py-3 bg-blue-500 text-white rounded-md font-semibold hover:bg-blue-600"></button><button id="who-won-p2" class="w-full py-3 bg-blue-500 text-white rounded-md font-semibold hover:bg-blue-600"></button></div><button onclick="closeModal()" class="mt-6 text-sm text-gray-500 hover:text-gray-700">Cancel</button></div></div>
    <div id="payment-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-1/3 text-center"><h2 class="text-2xl font-bold mb-2 text-gray-900">Payment</h2><p id="payment-details" class="text-gray-600 mb-6">Total Bill: Rs. 0</p><div class="grid grid-cols-2 gap-4"><button id="payment-cash" class="w-full py-3 bg-green-500 text-white rounded-md font-semibold hover:bg-green-600">Cash</button><button id="payment-online" class="w-full py-3 bg-blue-500 text-white rounded-md font-semibold hover:bg-blue-600">Online</button><button id="payment-credit" class="w-full py-3 bg-purple-500 text-white rounded-md font-semibold hover:bg-purple-600">Credit</button><button id="payment-wait" class="w-full py-3 bg-yellow-500 text-white rounded-md font-semibold hover:bg-yellow-600">Wait</button></div><button onclick="closeModal()" class="mt-6 text-sm text-gray-500 hover:text-gray-700">Cancel</button></div></div>
    <div id="waiting-list-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-2/3"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-gray-900">Waiting List (Unpaid Bills)</h2><button onclick="closeModal()" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button></div><div class="mb-4"><input type="search" id="waiting-search" onkeyup="filterTable('waiting-search', 'waiting-list-body', 1)" placeholder="Search by name..." class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900"></div><div class="max-h-96 overflow-y-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Table</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th><th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Amount</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Time</th><th class="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase">Action</th></tr></thead><tbody id="waiting-list-body" class="bg-white divide-y divide-gray-200"></tbody></table></div></div></div>
    <div id="waiting-payment-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-1/4 text-center"><h2 class="text-2xl font-bold mb-2 text-gray-900">Clear Waiting Bill</h2><p id="waiting-payment-details" class="text-gray-600 mb-6">Total Bill: Rs. 0</p><div class="grid grid-cols-2 gap-4"><button id="waiting-payment-cash" class="w-full py-3 bg-green-500 text-white rounded-md font-semibold hover:bg-green-600">Cash</button><button id="waiting-payment-online" class="w-full py-3 bg-blue-500 text-white rounded-md font-semibold hover:bg-blue-600">Online</button></div><div class="mt-4"><button id="waiting-payment-credit" class="w-full py-3 bg-purple-500 text-white rounded-md font-semibold hover:bg-purple-600">Move to Credit</button></div><button onclick="closeModal()" class="mt-6 text-sm text-gray-500 hover:text-gray-700">Cancel</button></div></div>
    <div id="transactions-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-2/3"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-gray-900">Online Transactions</h2><button onclick="closeModal()" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button></div><div class="mb-4"><input type="search" id="transactions-search" onkeyup="filterTable('transactions-search', 'transactions-body', 1)" placeholder="Search by name..." class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900"></div><div class="max-h-96 overflow-y-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Table</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th><th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Amount</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Time</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th></tr></thead><tbody id="transactions-body" class="bg-white divide-y divide-gray-200"></tbody></table></div></div></div>
    <div id="canteen-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-1/3"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-gray-900">Canteen</h2><button onclick="closeModal()" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button></div><p>Canteen functionality will be added here.</p></div></div>
    <div id="paid-records-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-2/3"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-gray-900">Paid Records</h2><button onclick="closeModal()" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button></div><div class="mb-4"><input type="search" id="paid-records-search" onkeyup="filterTable('paid-records-search', 'paid-records-body', 1)" placeholder="Search by name..." class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900"></div><div class="max-h-96 overflow-y-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Table</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th><th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Amount</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Time</th><th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Payment Method</th></tr></thead><tbody id="paid-records-body" class="bg-white divide-y divide-gray-200"></tbody></table></div></div></div>
    <div id="admin-login-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-1/4"><h2 class="text-2xl font-bold mb-4 text-gray-900">Admin Login</h2><form id="admin-login-form"><div class="mb-4"><label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label><input type="text" id="username" class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900" required></div><div class="mb-4"><label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label><input type="password" id="password" class="w-full bg-gray-50 border border-gray-300 rounded-md px-3 py-2 text-gray-900" required></div><p id="login-error" class="text-red-500 text-sm mb-4 hidden">Invalid username or password.</p><div class="flex justify-end space-x-4"><button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-800 hover:bg-gray-300 rounded-md font-semibold">Cancel</button><button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md font-semibold">Login</button></div></form></div></div>
    <div id="admin-panel-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-lg shadow-xl p-6 w-11/12 md:w-2/3"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-gray-900">Admin Panel - Sales Report</h2><button onclick="closeModal()" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button></div><div class="flex justify-center space-x-2 mb-6 border-b pb-4"><button id="btn-daily" onclick="generateSalesReport('daily')" class="px-4 py-2 text-sm bg-gray-200 rounded-md hover:bg-gray-300">Today</button><button id="btn-monthly" onclick="generateSalesReport('monthly')" class="px-4 py-2 text-sm bg-gray-200 rounded-md hover:bg-gray-300">This Month</button><button id="btn-yearly" onclick="generateSalesReport('yearly')" class="px-4 py-2 text-sm bg-gray-200 rounded-md hover:bg-gray-300">This Year</button></div><div id="sales-report-content" class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center"></div><div class="mt-6 text-center"><button onclick="resetAllData()" class="px-6 py-2 text-sm bg-red-600 text-white rounded-md shadow-sm hover:bg-red-700">Reset All Data</button></div></div></div>

    <script>
        // --- CONFIGURATION ---
        let STANDARD_PRICES = {
            'Full Frame': 180, '10 Ball': 150, '6 Ball': 100, '1 Ball': 50, 
            'Century': 700 // Per Hour
        };
        let TABLE_1_PRICES = {
            'Full Frame': 250, '10 Ball': 200, '6 Ball': 180, '1 Ball': 150, 
            'Century': 1200 // Per Hour
        };

        // --- APPLICATION STATE ---
        let tables = [];
        let ledger = [];
        let waitingList = [];
        let transactions = [];
        let paidRecords = [];
        let modalStack = [];

        // --- CORE FUNCTIONS ---
        function initializeApp() {
            const savedStandardPrices = localStorage.getItem('snookerStandardPrices');
            if (savedStandardPrices) STANDARD_PRICES = JSON.parse(savedStandardPrices);
            const savedTable1Prices = localStorage.getItem('snookerTable1Prices');
            if (savedTable1Prices) TABLE_1_PRICES = JSON.parse(savedTable1Prices);

            const savedTables = localStorage.getItem('snookerTables');
            if (savedTables) tables = JSON.parse(savedTables);
            else {
                tables = Array.from({ length: 8 }, (_, i) => ({id: i + 1, name: i < 7 ? `Table ${i + 1}` : 'VIP Room', status: 'available', player1: '', player2: '', startTime: null, endTime: null, gameType: '', price: 0}));
            }
            
            const savedLedger = localStorage.getItem('snookerLedger');
            if(savedLedger) ledger = JSON.parse(savedLedger);
            
            const savedWaitingList = localStorage.getItem('snookerWaitingList');
            if(savedWaitingList) waitingList = JSON.parse(savedWaitingList);
            
            const savedTransactions = localStorage.getItem('snookerTransactions');
            if(savedTransactions) transactions = JSON.parse(savedTransactions);
            
            const savedPaidRecords = localStorage.getItem('snookerPaidRecords');
            if(savedPaidRecords) paidRecords = JSON.parse(savedPaidRecords);

            renderTables();
            updateAllBadges();
            setInterval(renderTables, 1000);
        }

        // --- RENDERING ---
        function renderTables() {
            const tbody = document.getElementById('tables-body');
            tbody.innerHTML = ''; 
            tables.forEach(table => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50";
                const statusMap = {available: { text: 'Free', color: 'status-available' }, 'in-use': { text: 'Playing', color: 'status-in-use' }, 'pending': { text: 'Pending', color: 'status-pending' }};
                const currentStatus = statusMap[table.status];
                tr.innerHTML = `<td class="py-3 px-4 font-semibold">${table.name}</td><td class="py-3 px-4">${table.player1 ? `${table.player1}${table.player2 ? ' vs ' + table.player2 : ''}` : '-'}</td><td class="py-3 px-4">${table.gameType || '-'}</td><td class="py-3 px-4">${table.startTime ? new Date(table.startTime).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true }) : '-'}</td><td class="py-3 px-4">${table.startTime ? calculateDuration(table.startTime, table.endTime) : '-'}</td><td class="py-3 px-4">Rs. ${table.price}</td><td class="py-3 px-4"><div class="flex items-center"><span class="status-dot ${currentStatus.color}"></span>${currentStatus.text}</div></td><td class="py-3 px-4" id="actions-${table.id}"></td>`;
                tbody.appendChild(tr);
                renderActionButtons(table);
            });
        }
        
        function renderActionButtons(table) {
            const actionsCell = document.getElementById(`actions-${table.id}`);
            actionsCell.innerHTML = '';
            let button;
            if (table.status === 'available') button = createButton('Start', 'bg-green-500', 'hover:bg-green-600', () => openStartGameModal(table.id));
            else if (table.status === 'in-use') button = createButton('End Game', 'bg-red-500', 'hover:bg-red-600', () => endGameAndSetPending(table.id));
            else if (table.status === 'pending') button = createButton('Pay', 'bg-blue-500', 'hover:bg-blue-600', () => openWhoWonModal(table.id));
            if(button) actionsCell.appendChild(button);
        }

        function createButton(text, bgColor, hoverColor, onClick) {
            const button = document.createElement('button');
            button.innerText = text;
            button.className = `px-3 py-1 text-sm text-white rounded-md shadow-sm ${bgColor} ${hoverColor}`;
            button.onclick = onClick;
            return button;
        }

        // --- MODAL & CONFIRMATION ---
        function openModal(modalId, isPartOfFlow = false) {
            if (!isPartOfFlow && modalStack.length > 0) {
                document.getElementById(modalStack[modalStack.length - 1]).classList.add('hidden');
            }
            modalStack.push(modalId);
            document.getElementById(modalId).classList.remove('hidden');
            document.getElementById(modalId).classList.add('flex');
        }

        function closeModal() {
            if (modalStack.length === 0) return;
            const closedModalId = modalStack.pop();
            document.getElementById(closedModalId).classList.add('hidden');
            document.getElementById(closedModalId).classList.remove('flex');

            if (modalStack.length > 0) {
                const previousModalId = modalStack[modalStack.length - 1];
                document.getElementById(previousModalId).classList.remove('hidden');
                document.getElementById(previousModalId).classList.add('flex');
            }
        }

        function closeAllModals() {
            while (modalStack.length > 0) {
                const modalId = modalStack.pop();
                document.getElementById(modalId).classList.add('hidden');
                document.getElementById(modalId).classList.remove('flex');
            }
        }
        
        function openStartGameModal(tableId) {
            const table = tables.find(t => t.id === tableId);
            document.getElementById('modal-title').innerText = `Start Game on ${table.name}`;
            document.getElementById('modal-table-id').value = tableId;
            const prices = table.id === 1 ? TABLE_1_PRICES : STANDARD_PRICES;
            populateGameOptions(prices);
            openModal('start-game-modal');
        }
        function showConfirmation(title, message, onConfirm, okClass = 'bg-red-600', okText = 'OK') {
            document.getElementById('confirm-title').innerText = title;
            document.getElementById('confirm-message').innerText = message;
            const confirmOkButton = document.getElementById('confirm-ok');
            const newOkButton = confirmOkButton.cloneNode(true);
            newOkButton.innerText = okText;
            newOkButton.className = `px-6 py-2 ${okClass} hover:opacity-90 text-white rounded-md font-semibold`;
            confirmOkButton.parentNode.replaceChild(newOkButton, confirmOkButton);
            newOkButton.onclick = () => { onConfirm(); closeModal(); };
            document.getElementById('confirm-cancel').onclick = () => closeModal();
            openModal('confirmation-modal');
        }
        function populateGameOptions(prices) {
            const select = document.getElementById('game-type');
            select.innerHTML = '';
            for (const game in prices) {
                const option = document.createElement('option');
                option.value = game;
                let priceText = `(Rs. ${prices[game]})`;
                if (game === 'Century') priceText = `(Rs. ${prices[game]}/hr)`;
                option.innerText = `${game} ${priceText}`;
                select.appendChild(option);
            }
        }

        // --- GAME LOGIC ---
        document.getElementById('start-game-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const tableId = parseInt(document.getElementById('modal-table-id').value);
            const player1 = document.getElementById('player1').value;
            const player2 = document.getElementById('player2').value;
            const gameType = document.getElementById('game-type').value;
            startGame(tableId, player1, player2, gameType);
            closeModal();
            this.reset();
        });
        function startGame(tableId, player1, player2, gameType) {
            const table = tables.find(t => t.id === tableId);
            if (table && table.status === 'available') {
                table.status = 'in-use'; table.player1 = player1; table.player2 = player2;
                table.startTime = new Date().toISOString(); table.gameType = gameType;
                const prices = table.id === 1 ? TABLE_1_PRICES : STANDARD_PRICES;
                table.price = prices[gameType];
                saveTablesState();
            }
        }
        
        function endGameAndSetPending(tableId) {
            const table = tables.find(t => t.id === tableId);
            if (!table || table.status !== 'in-use') return;
            
            table.endTime = new Date().toISOString();
            if (table.gameType === 'Century') {
                const durationInMinutes = (new Date(table.endTime) - new Date(table.startTime)) / 60000;
                const prices = table.id === 1 ? TABLE_1_PRICES : STANDARD_PRICES;
                const pricePerHour = prices['Century'];
                table.price = Math.round((durationInMinutes / 60) * pricePerHour);
            }
            table.status = 'pending';
            saveTablesState();
        }

        function resetTable(tableId) {
            const table = tables.find(t => t.id === tableId);
            if (table) {
                table.status = 'available'; table.player1 = ''; table.player2 = '';
                table.startTime = null; table.endTime = null;
                table.gameType = ''; table.price = 0;
                saveTablesState();
            }
        }
        
        // --- PAYMENT LOGIC ---
        function openWhoWonModal(tableId) {
            const table = tables.find(t => t.id === tableId);
            if (!table) return;
            
            const p1Button = document.getElementById('who-won-p1');
            const p2Button = document.getElementById('who-won-p2');

            p1Button.innerText = `${table.player1} Won`;
            p2Button.innerText = `${table.player2} Won`;

            p1Button.onclick = () => { openPaymentModal(tableId, table.player2); };
            p2Button.onclick = () => { openPaymentModal(tableId, table.player1); };

            openModal('who-won-modal', true);
        }

        function openPaymentModal(tableId, loserName) {
            const table = tables.find(t => t.id === tableId);
            if (!table) return;
            
            document.getElementById('payment-details').innerText = `Total Bill for ${loserName}: Rs. ${table.price}`;
            
            document.getElementById('payment-cash').onclick = () => handleCashPayment(tableId, loserName);
            document.getElementById('payment-online').onclick = () => handleOnlinePayment(tableId, loserName);
            document.getElementById('payment-credit').onclick = () => handleCreditPayment(tableId, loserName);
            document.getElementById('payment-wait').onclick = () => handleWaitPayment(tableId, loserName);

            openModal('payment-modal', true);
        }

        function handleCashPayment(tableId, payerName) { 
            const table = tables.find(t => t.id === tableId);
            if (table) {
                paidRecords.push({ id: Date.now(), tableName: table.name, name: payerName, amount: table.price, time: new Date().toISOString(), method: 'Cash' });
                savePaidRecordsState();
                resetTable(tableId);
            }
            closeAllModals(); 
        }
        
        function handleOnlinePayment(tableId, payerName) {
            const table = tables.find(t => t.id === tableId);
            if (table) {
                transactions.push({ id: Date.now(), tableName: table.name, name: payerName, amount: table.price, time: new Date().toISOString(), status: 'Received' });
                saveTransactionsState();
                paidRecords.push({ id: Date.now(), tableName: table.name, name: payerName, amount: table.price, time: new Date().toISOString(), method: 'Online' });
                savePaidRecordsState();
                resetTable(tableId);
            }
            closeAllModals();
        }

        function handleCreditPayment(tableId, loserName) {
            const table = tables.find(t => t.id === tableId);
            if (!table) return;
            
            // Manually close payment and who-won modals before opening credit modal
            closeModal(); // closes payment-modal
            closeModal(); // closes who-won-modal

            document.getElementById('credit-table-id').value = table.id;
            document.getElementById('credit-name').value = loserName;
            document.getElementById('credit-amount').value = table.price;
            document.getElementById('credit-note').value = `Game Bill - ${table.name} (${table.gameType})`;
            openModal('add-credit-modal', true);
        }

        function handleWaitPayment(tableId, loserName) {
            const table = tables.find(t => t.id === tableId);
            if (table) {
                waitingList.push({ id: Date.now(), name: loserName, amount: table.price, time: new Date().toISOString(), tableName: table.name });
                saveWaitingListState();
                resetTable(tableId);
            }
            closeAllModals();
        }

        // --- ADMIN & SETTINGS LOGIC ---
        document.getElementById('admin-login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            if (user === 'admin' && pass === 'admin') {
                document.getElementById('login-error').classList.add('hidden');
                closeModal();
                generateSalesReport('daily');
                openModal('admin-panel-modal');
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        });

        function openSettingsModal() {
            alert("Please login to Admin panel to change settings.");
        }

        function highlightAdminButton(activeButtonId) {
            ['btn-daily', 'btn-monthly', 'btn-yearly'].forEach(id => {
                const button = document.getElementById(id);
                button.classList.remove('bg-blue-500', 'text-white');
                button.classList.add('bg-gray-200');
            });
            const activeButton = document.getElementById(activeButtonId);
            activeButton.classList.add('bg-blue-500', 'text-white');
            activeButton.classList.remove('bg-gray-200');
        }

        function generateSalesReport(filterType) {
            highlightAdminButton(`btn-${filterType}`);
            const now = new Date();
            let filteredPaid = [];
            let filteredCredit = [];

            if (filterType === 'daily') {
                filteredPaid = paidRecords.filter(p => new Date(p.time).toDateString() === now.toDateString());
                filteredCredit = ledger.filter(l => new Date(l.date).toDateString() === now.toDateString());
            } else if (filterType === 'monthly') {
                filteredPaid = paidRecords.filter(p => new Date(p.time).getMonth() === now.getMonth() && new Date(p.time).getFullYear() === now.getFullYear());
                filteredCredit = ledger.filter(l => new Date(l.date).getMonth() === now.getMonth() && new Date(l.date).getFullYear() === now.getFullYear());
            } else if (filterType === 'yearly') {
                filteredPaid = paidRecords.filter(p => new Date(p.time).getFullYear() === now.getFullYear());
                filteredCredit = ledger.filter(l => new Date(l.date).getFullYear() === now.getFullYear());
            }

            let totalCash = 0;
            let totalOnline = 0;
            filteredPaid.forEach(p => {
                if (p.method === 'Cash') totalCash += p.amount;
                if (p.method === 'Online') totalOnline += p.amount;
            });

            let totalCreditGiven = 0;
            filteredCredit.forEach(l => {
                if (l.amount < 0) totalCreditGiven += Math.abs(l.amount);
            });
            
            const content = document.getElementById('sales-report-content');
            if (totalCash === 0 && totalOnline === 0 && totalCreditGiven === 0) {
                content.innerHTML = `<p class="col-span-3 text-center text-gray-500 py-8">No earnings recorded for this period.</p>`;
            } else {
                content.innerHTML = `
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-green-800">Cash Received</h3>
                        <p class="text-3xl font-bold text-green-600">Rs. ${totalCash.toFixed(2)}</p>
                    </div>
                    <div class="bg-blue-100 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-blue-800">Online Received</h3>
                        <p class="text-3xl font-bold text-blue-600">Rs. ${totalOnline.toFixed(2)}</p>
                    </div>
                    <div class="bg-red-100 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-red-800">Credit Given</h3>
                        <p class="text-3xl font-bold text-red-600">Rs. ${totalCreditGiven.toFixed(2)}</p>
                    </div>
                `;
            }
        }
        
        function resetAllData() {
            showConfirmation('Reset All Data?', 'Are you sure you want to delete all data? This cannot be undone.', () => {
                localStorage.clear();
                // Reset all state variables
                tables = [];
                ledger = [];
                waitingList = [];
                transactions = [];
                paidRecords = [];
                // Re-initialize the app to default state
                initializeApp();
                closeModal();
            }, 'bg-red-600', 'Yes, Reset');
        }

        // --- LEDGER LOGIC ---
        document.getElementById('add-credit-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('credit-name').value;
            let amount = parseFloat(document.getElementById('credit-amount').value);
            const note = document.getElementById('credit-note').value;
            const tableIdToReset = parseInt(document.getElementById('credit-table-id').value);
            const waitingIdToReset = parseInt(document.getElementById('credit-waiting-id').value);

            if (name && !isNaN(amount)) {
                if (!isNaN(tableIdToReset) || !isNaN(waitingIdToReset) || document.getElementById('credit-name').readOnly) {
                    amount = -Math.abs(amount);
                }

                ledger.push({ id: Date.now(), date: new Date().toISOString(), name, amount, note });
                saveLedgerState();
                if (!isNaN(tableIdToReset)) { resetTable(tableIdToReset); }
                if (!isNaN(waitingIdToReset)) { waitingList = waitingList.filter(entry => entry.id !== waitingIdToReset); saveWaitingListState(); openWaitingListModal(); }
                
                if (!isNaN(tableIdToReset) || !isNaN(waitingIdToReset)) {
                    closeAllModals();
                } else {
                    closeModal();
                }
                
                this.reset();
                document.getElementById('credit-table-id').value = '';
                document.getElementById('credit-waiting-id').value = '';
                document.getElementById('credit-name').readOnly = false;
            }
        });

        function viewLedgerFromCredit() { openLedgerModal(); }

        function openLedgerModal() {
            localStorage.setItem('snookerCreditNotification', 'false');
            updateCreditNotificationDot();

            const ledgerBody = document.getElementById('ledger-body');
            const ledgerSummary = document.getElementById('ledger-summary');
            ledgerBody.innerHTML = '';
            let grandTotal = 0;
            const customerData = {};

            ledger.forEach(entry => {
                if (!customerData[entry.name]) {
                    customerData[entry.name] = { balance: 0, lastUpdated: 'N/A' };
                }
                customerData[entry.name].balance += entry.amount;
                customerData[entry.name].lastUpdated = entry.date;
            });

            for (const name in customerData) {
                const data = customerData[name];
                if (data.balance === 0) continue; 

                const tr = document.createElement('tr');
                const balanceColor = data.balance < 0 ? 'text-red-600' : 'text-green-600';
                tr.innerHTML = `
                    <td class="px-4 py-2 font-medium">${name}</td>
                    <td class="px-4 py-2 text-sm text-gray-500">${new Date(data.lastUpdated).toLocaleDateString()}</td>
                    <td class="px-4 py-2 text-right font-semibold ${balanceColor}">Rs. ${Math.abs(data.balance).toFixed(2)}</td>
                    <td class="px-4 py-2 text-center space-x-2">
                        <button onclick="openPayCreditModal('${name}')" class="px-2 py-1 text-xs text-white bg-red-500 rounded hover:bg-red-600">Remove</button>
                        <button onclick="addCreditForCustomer('${name}')" class="px-2 py-1 text-xs text-white bg-green-500 rounded hover:bg-green-600">Add</button>
                    </td>
                `;
                ledgerBody.appendChild(tr);
                grandTotal += data.balance;
            }
            
            const balanceColor = grandTotal < 0 ? 'text-red-600' : 'text-green-600';
            ledgerSummary.innerHTML = `<p class="text-lg font-bold">Total Balance: <span class="${balanceColor}">Rs. ${Math.abs(grandTotal).toFixed(2)}</span></p>`;
            openModal('ledger-modal');
        }
        
        function addCreditForCustomer(name) {
            const nameInput = document.getElementById('credit-name');
            nameInput.value = name;
            nameInput.readOnly = true;
            document.getElementById('credit-amount').placeholder = "Debit amount (e.g. 500)";
            openModal('add-credit-modal', true);
        }
        
        document.getElementById('add-credit-modal').addEventListener('click', function(e) {
            if (e.target.id !== 'add-credit-modal') return;
            document.getElementById('credit-name').readOnly = false;
            document.getElementById('add-credit-form').reset();
        });

        function openPayCreditModal(customerName) {
            let customerBalance = 0;
            ledger.forEach(entry => {
                if (entry.name === customerName) {
                    customerBalance += entry.amount;
                }
            });

            const absoluteBalance = Math.abs(customerBalance);
            document.getElementById('pay-credit-title').innerText = `Pay Credit for ${customerName}`;
            document.getElementById('pay-credit-balance').innerText = `Current Credit: Rs. ${absoluteBalance.toFixed(2)}`;
            
            const amountInput = document.getElementById('pay-credit-amount');
            amountInput.value = '';
            amountInput.max = absoluteBalance;

            amountInput.oninput = () => {
                if (parseFloat(amountInput.value) > absoluteBalance) {
                    amountInput.value = absoluteBalance;
                }
            };

            document.getElementById('pay-credit-submit').onclick = () => {
                const amount = parseFloat(amountInput.value);
                if (!isNaN(amount) && amount > 0) {
                    ledger.push({ id: Date.now(), date: new Date().toISOString(), name: customerName, amount: amount, note: "Payment Received" });
                    saveLedgerState();
                    closeAllModals();
                }
            };
            
            document.getElementById('pay-credit-clear-all').onclick = () => {
                if (customerBalance < 0) {
                    ledger.push({ id: Date.now(), date: new Date().toISOString(), name: customerName, amount: -customerBalance, note: "Full Payment Received" });
                    saveLedgerState();
                }
                closeAllModals();
            };

            openModal('pay-credit-modal', true);
        }


        // --- WAITING LIST LOGIC ---
        function openWaitingListModal() {
            const waitingBody = document.getElementById('waiting-list-body');
            waitingBody.innerHTML = '';
            if (waitingList.length === 0) {
                waitingBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No one is waiting for payment.</td></tr>';
            } else {
                [...waitingList].reverse().forEach((entry) => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-2 font-medium">${entry.tableName}</td>
                        <td class="px-4 py-2 font-medium">${entry.name}</td>
                        <td class="px-4 py-2 text-right font-semibold text-red-600">Rs. ${entry.amount.toFixed(2)}</td>
                        <td class="px-4 py-2 text-sm text-gray-500">${new Date(entry.time).toLocaleTimeString()}</td>
                        <td class="px-4 py-2 text-center">
                            <button onclick="openWaitingPaymentModal(${entry.id})" class="px-4 py-1 text-sm text-white rounded-md shadow-sm bg-blue-500 hover:bg-blue-600">Pay</button>
                        </td>
                    `;
                    waitingBody.appendChild(tr);
                });
            }
            openModal('waiting-list-modal');
        }

        function openWaitingPaymentModal(waitingId) {
            const entry = waitingList.find(e => e.id === waitingId);
            if (!entry) return;

            document.getElementById('waiting-payment-details').innerText = `Bill for ${entry.name}: Rs. ${entry.amount}`;

            document.getElementById('waiting-payment-cash').onclick = () => { 
                paidRecords.push({ id: Date.now(), tableName: entry.tableName, name: entry.name, amount: entry.amount, time: new Date().toISOString(), method: 'Cash' });
                savePaidRecordsState();
                clearWaitingEntry(waitingId); 
                closeAllModals(); 
            };
            document.getElementById('waiting-payment-online').onclick = () => { 
                transactions.push({ id: Date.now(), tableName: entry.tableName, name: entry.name, amount: entry.amount, time: new Date().toISOString(), status: 'Received' });
                saveTransactionsState();
                paidRecords.push({ id: Date.now(), tableName: entry.tableName, name: entry.name, amount: entry.amount, time: new Date().toISOString(), method: 'Online' });
                savePaidRecordsState();
                clearWaitingEntry(waitingId); 
                closeAllModals(); 
            };
            document.getElementById('waiting-payment-credit').onclick = () => { moveWaitingToCredit(waitingId); };

            openModal('waiting-payment-modal', true);
        }

        function clearWaitingEntry(waitingId) {
            waitingList = waitingList.filter(entry => entry.id !== waitingId);
            saveWaitingListState();
            openWaitingListModal(); // Refresh list
        }

        function moveWaitingToCredit(waitingId) {
            const entry = waitingList.find(e => e.id === waitingId);
            if (!entry) return;

            document.getElementById('credit-waiting-id').value = entry.id;
            document.getElementById('credit-name').value = entry.name;
            document.getElementById('credit-amount').value = entry.amount;
            document.getElementById('credit-note').value = `Unpaid Bill from ${entry.tableName}`;
            
            openModal('add-credit-modal', true);
        }
        
        // --- TRANSACTIONS LOGIC ---
        function openTransactionsModal() {
            const transactionsBody = document.getElementById('transactions-body');
            transactionsBody.innerHTML = '';
            if (transactions.length === 0) {
                transactionsBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No transactions recorded.</td></tr>';
            } else {
                [...transactions].reverse().forEach(entry => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-2 font-medium">${entry.tableName}</td>
                        <td class="px-4 py-2 font-medium">${entry.name}</td>
                        <td class="px-4 py-2 text-right font-semibold text-green-600">Rs. ${entry.amount.toFixed(2)}</td>
                        <td class="px-4 py-2 text-sm text-gray-500">${new Date(entry.time).toLocaleTimeString()}</td>
                        <td class="px-4 py-2 text-sm text-gray-500">${entry.status}</td>
                    `;
                    transactionsBody.appendChild(tr);
                });
            }
            openModal('transactions-modal');
        }
        
        // --- PAID RECORDS LOGIC ---
        function openPaidRecordsModal() {
            const paidBody = document.getElementById('paid-records-body');
            paidBody.innerHTML = '';
            if (paidRecords.length === 0) {
                paidBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">No paid records found.</td></tr>';
            } else {
                [...paidRecords].reverse().forEach(entry => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-2 font-medium">${entry.tableName}</td>
                        <td class="px-4 py-2 font-medium">${entry.name}</td>
                        <td class="px-4 py-2 text-right font-semibold text-green-600">Rs. ${entry.amount.toFixed(2)}</td>
                        <td class="px-4 py-2 text-sm text-gray-500">${new Date(entry.time).toLocaleTimeString()}</td>
                        <td class="px-4 py-2 text-sm text-gray-500">${entry.method}</td>
                    `;
                    paidBody.appendChild(tr);
                });
            }
            openModal('paid-records-modal');
        }

        // --- UTILITIES ---
        function filterTable(inputId, tableBodyId, cellIndex) {
            const input = document.getElementById(inputId);
            const filter = input.value.toUpperCase();
            const tableBody = document.getElementById(tableBodyId);
            const tr = tableBody.getElementsByTagName("tr");

            for (let i = 0; i < tr.length; i++) {
                const td = tr[i].getElementsByTagName("td")[cellIndex];
                if (td) {
                    const txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
        function capitalizeInput(element) {
            element.value = element.value.charAt(0).toUpperCase() + element.value.slice(1);
        }
        function updateAllBadges() {
            updateWaitingCountBadge();
            updateTransactionsCountBadge();
            updateCreditNotificationDot();
            updatePaidRecordsCountBadge();
        }
        function updateWaitingCountBadge() {
            const countBadge = document.getElementById('waiting-list-count');
            if (waitingList.length > 0) {
                countBadge.innerText = waitingList.length;
                countBadge.classList.remove('hidden');
            } else {
                countBadge.classList.add('hidden');
            }
        }
        function updateTransactionsCountBadge() {
            const countBadge = document.getElementById('transactions-count');
            if (transactions.length > 0) {
                countBadge.innerText = transactions.length;
                countBadge.classList.remove('hidden');
            } else {
                countBadge.classList.add('hidden');
            }
        }
        function updateCreditNotificationDot() {
            const dot = document.getElementById('credit-notification-dot');
            const historyDot = document.getElementById('history-notification-dot');
            if (localStorage.getItem('snookerCreditNotification') === 'true') {
                dot.classList.remove('hidden');
                historyDot.classList.remove('hidden');
            } else {
                dot.classList.add('hidden');
                historyDot.classList.add('hidden');
            }
        }
        function updatePaidRecordsCountBadge() {
            const countBadge = document.getElementById('paid-records-count');
            if (paidRecords.length > 0) {
                countBadge.innerText = paidRecords.length;
                countBadge.classList.remove('hidden');
            } else {
                countBadge.classList.add('hidden');
            }
        }
        function calculateDuration(start, end = null) {
            if (!start) return '-';
            const startDate = new Date(start);
            const endDate = end ? new Date(end) : new Date();
            let diff = Math.max(0, (endDate.getTime() - startDate.getTime()) / 1000);
            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor(diff / 60);
            const seconds = Math.floor(diff % 60);
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        function saveTablesState() { localStorage.setItem('snookerTables', JSON.stringify(tables)); renderTables(); }
        function saveLedgerState() { 
            localStorage.setItem('snookerLedger', JSON.stringify(ledger));
            localStorage.setItem('snookerCreditNotification', 'true');
            updateCreditNotificationDot();
        }
        function saveWaitingListState() { 
            localStorage.setItem('snookerWaitingList', JSON.stringify(waitingList));
            updateWaitingCountBadge();
        }
        function saveTransactionsState() { 
            localStorage.setItem('snookerTransactions', JSON.stringify(transactions));
            updateTransactionsCountBadge();
        }
        function savePaidRecordsState() { 
            localStorage.setItem('snookerPaidRecords', JSON.stringify(paidRecords)); 
            updatePaidRecordsCountBadge();
        }


        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
